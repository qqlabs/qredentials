<html>

<head>
	<meta charset="utf-8" />
	<title>QRCode Generator</title>
	<script src="../js/jquery-2.1.1.js"></script>
	<script src="../js/jsqr-0.2-min.js" type="text/javascript"></script>
</head>

<body>
	<form>
	<label for='inURL'>URL:</label> 
	<input type='text' id='inURL' name='inURL' value=''>
	<input type='button' onclick='generate(document.getElementById("inURL").value, "URL");' value="Submit">
	</form>
	<br>

	<form id="encode:vcard">
          <input hidden="true" name='version' value='3.0'>
          <input hidden="true" name='type' value='person'>
          <label for="firstName">First Name:</label>
          <input type="text" name='firstName' value=''>
          <br>
          <label for="middleName">Middle Name:</label>
          <input type="text" name='middleName' value=''>
          <br>
          <label for="lastName">Last Name:</label>
          <input type="text" name='lastName' value=''>
          <br>
          <label for="organization">Organization:</label>
          <input type="text" name='organization' value=''>
          <br>
          <label for="title">Title:</label>
          <input type="text" name='title' value=''>
          <br>
          <label for="phone">Phone:</label>
          <input type="text" name='phone' value=''>
          <input type='button' onclick='ConvertFormToJSON(this.form);' value="Submit">
    </form>

    <br>
	<canvas id="qrcode"></canvas>
</body>
<script type="text/javascript">
	'use strict';
		function generateURL(info){
			var qr = new JSQR();
			var input = new qr.Input();						// Initialize a new Input object.
			input.dataType = input.DATA_TYPE.URL;
			input.data = {
				"url": info
			};

			return input;
		};
		function generateVCARD(info){
			var qr = new JSQR();
			var input = new qr.Input();
			info = info.substring(1,info.length-1);
			input.dataType = input.DATA_TYPE.VCARD;
			input.data = {
				"version": "3.0",
			     "type": "person",
			     "firstName": "first",
			     "middleName": "middle",
			     "lastName": "last"
			};
			return input;
		};
		function generate(info, type) {
			var qr = new JSQR();							// Initialize a new JSQR object.
			var code = new qr.Code();						// Initialize a new Code object.

			code.encodeMode = code.ENCODE_MODE.UTF8_SIGNATURE;			// Set the code datatype.
			code.version = code.DEFAULT;						// Set the code version
														// (DEFAULT = use the smallest possible version).
			code.errorCorrection = code.ERROR_CORRECTION.H;		// Set the error correction level (H = High).

			var input;

			if(type == "URL"){
				input = generateURL(info);
			}
			else if(type == "vCard"){
				input = generateVCARD(info);
			}

			var matrix = new qr.Matrix(input, code);			// Initialize a new Matrix object using the input
														// and code, defined above.
														// At this point, the QR Code get generated.

			matrix.scale = 4;								// Specify the scaling for graphic output.
			matrix.margin = 2;								// Specify the margin for graphic output.

			var canvas = document.getElementById('qrcode');		// Create a new Canvas element.
			canvas.setAttribute('width', matrix.pixelWidth);		// Set the canvas width to the size of the QR code.
			canvas.setAttribute('height', matrix.pixelWidth);		// Set the canvas height to the size of the QR code.
			canvas.getContext('2d').fillStyle = 'rgb(0,0,0)';		// Set the foreground color of the canvas to black.
			matrix.draw(canvas, 0, 0);						// Draw the QR code into the canvas
														// at position 0 (left), 0 (top).
			// document.body.appendChild(canvas);					// Append the canvas element to the documents body.
		};
		function ConvertFormToJSON(form){
			var array = jQuery(form).serializeArray();
			var json = {};
			jQuery.each(array, function() {
				if(this.value != ""){
					json[this.name] = this.value || '';
				}
			});
			generate(JSON.stringify(json),'vCard');
		}
	</script>
	</html>